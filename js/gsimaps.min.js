!function(){var e={},t=[],a=function(t,o){var n=$("<li/>");if(t.entries){n.addClass("close"),$("<a class='toggle' href='#'/>").text(t.title).appendTo(n);var r=$("<ul/>").appendTo(n);t.entries.forEach(function(e){a(e,r)})}else $("<a class='layer'/>").attr("href","#"+t.id).text(t.title).appendTo(n),e[t.id]=L.tileLayer(t.url,t);n.appendTo(o)};$("[data-layers]").each(function(){var e=$(this);t.push(new Promise(function(t,o){$.getJSON(e.attr("data-layers"),function(o,n,r){o.layers.forEach(function(t){a(t,e)}),t()})}))}),Promise.all(t).then(function(){var t={zoomControl:!1,zoom:5,center:[35.362222,138.731389],layers:[]},a=location.hash.replace(/^#/,"").split("/");if(a.length>3){var o=parseFloat(a.pop()),n=parseFloat(a.pop()),r=parseInt(a.pop());isNaN(o)||isNaN(n)||isNaN(r)||(t.center=[n,o],t.zoom=r),a.forEach(function(a){var o=e[a],n=1;a.match(/^(.+):([0-9]+)$/)&&(o=e[RegExp.$1],n=parseInt(RegExp.$2)/100),o&&(t.layers.push(o),o.setOpacity(n))})}0==t.layers.length&&t.layers.push(e.std);var i=L.map("map",t);$("a.toggle").on("click",function(){return $(this).parent().toggleClass("close"),!1}),$("a.layer").on("click",function(){var t=e[$(this).attr("href").replace(/^#/,"")];return i.hasLayer(t)?t.options.opacity>.25?t.setOpacity(t.options.opacity-.25):i.removeLayer(t):(i.addLayer(t),t.bringToFront().setOpacity(1)),i.fire("moveend"),!1}),i.on("moveend",function(){var e=[];i.eachLayer(function(t){var a=t.options.id;1!=t.options.opacity&&(a+=":"+Math.floor(100*t.options.opacity)),e.push(a)}),e.push(i.getZoom()),e.push(i.getCenter().lat.toFixed(6)),e.push(i.getCenter().lng.toFixed(6)),location.replace("#"+e.join("/"))}).fire("moveend")})}();